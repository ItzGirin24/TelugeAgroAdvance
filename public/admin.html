<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teluge Agro - Admin Panel</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ItzGirin24/TelugeAgro/refs/heads/main/logo%20Teluge.jpg" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>

    
    <link rel="stylesheet" href="admin.css">
</head>
<body class="text-gray-800">
    <header class="bg-green-700 text-white py-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center px-4 relative">
            <div class="flex items-center space-x-2">
                <img src="https://raw.githubusercontent.com/ItzGirin24/TelugeAgro/refs/heads/main/logo%20Teluge.jpg" alt="Green leaf icon symbolizing nature and agriculture, stylized as a fresh plant leaf in vibrant green hues" class="w-8 h-8 rounded-full placeholder-img">
                <h1 class="text-2xl font-bold text-shadow-green">Teluge Agro</h1>
            </div>
            <button id="hamburger-btn" aria-label="Toggle menu" class="md:hidden focus:outline-none z-30">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12" />
                    <line x1="3" y1="6" x2="21" y2="6" />
                    <line x1="3" y1="18" x2="21" y2="18" />
                </svg>
            </button>
            <nav id="nav-menu" class="hidden md:flex space-x-6 text-white font-semibold">
                <a href="leadingpage.html" class="hover:text-green-300">About</a>
                <a href="#products" class="hover:text-green-300">Products</a>
                <a href="#contact" class="hover:text-green-300">Contact</a>
                <a href="store.html" class="hover:text-green-300">Store</a>
                <!-- Pending Orders Indicator -->
                <div id="pending-orders-indicator" class="hover:text-green-300 relative cursor-pointer" title="Pending Orders">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                    <span id="pending-orders-count" class="absolute -top-2 -right-2 bg-orange-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center min-w-[20px]">0</span>
                </div>
                <a href="cart.html" id="cart-link" class="hover:text-green-300 relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                    </svg>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </nav>
            <script>
                // Synchronize cart count from localStorage
                function updateCartCount() {
                    const cartCountElement = document.getElementById('cart-count');
                    if (!cartCountElement) return;
                    const cartData = localStorage.getItem('cart');
                    let count = 0;
                    if (cartData) {
                        try {
                            const cart = JSON.parse(cartData);
                            count = Object.values(cart).reduce((acc, item) => acc + item.quantity, 0);
                        } catch (e) {
                            console.error('Error parsing cart data:', e);
                        }
                    }
                    cartCountElement.textContent = count;
                    if (count === 0) {
                        cartCountElement.style.display = 'none';
                    } else {
                        cartCountElement.style.display = 'flex';
                    }
                }
                // Update cart count on page load
                document.addEventListener('DOMContentLoaded', updateCartCount);
                // Optionally, listen for storage events to update count if cart changes in other tabs
                window.addEventListener('storage', (event) => {
                    if (event.key === 'cart') {
                        updateCartCount();
                    }
                });
            </script>
            <!-- Mobile menu -->
            <nav id="mobile-menu" class="hidden bg-green-600 text-white px-4 py-2 md:hidden flex flex-col space-y-2 absolute top-full right-4 rounded shadow-lg z-20 w-40">
                 <a href="leadingpage.html" class="hover:text-green-300">About</a>
                 <a href="#products" class="hover:text-green-300">Products</a>
           
                 <a href="store.html" class="hover:text-green-300">Store</a>
             <a href="cart.html" id="cart-link-mobile" class="hover:text-white bg-green-700 rounded-full px-3 py-1 flex items-center space-x-2 font-semibold relative">
                     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5H19M7 13v8a2 2 0 002 2h10a2 2 0 002-2v-3"></path>
                     </svg>
                <span id="cart-count-mobile" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                <span>Cart</span>
             </a>

             </nav>
         </div>
     </header>

    <!-- Dashboard Statistics -->
    <section class="py-8 bg-gradient-to-br from-green-50 to-green-100">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-green-800 mb-6">üìä Dashboard Admin</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- Total Orders -->
                <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Total Pesanan</h3>
                        <span class="text-3xl">üì¶</span>
                    </div>
                    <p class="text-3xl font-bold text-blue-600" id="stat-total-orders">0</p>
                    <p class="text-xs text-gray-500 mt-1">Semua pesanan</p>
                </div>

                <!-- Pending Orders -->
                <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Perlu Diproses</h3>
                        <span class="text-3xl">‚è≥</span>
                    </div>
                    <p class="text-3xl font-bold text-orange-600" id="stat-pending-orders">0</p>
                    <p class="text-xs text-gray-500 mt-1">Menunggu proses</p>
                </div>

                <!-- Total Revenue -->
                <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 border-green-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Total Pendapatan</h3>
                        <span class="text-3xl">üí∞</span>
                    </div>
                    <p class="text-2xl font-bold text-green-600" id="stat-total-revenue">Rp 0</p>
                    <p class="text-xs text-gray-500 mt-1">Dari pesanan lunas</p>
                </div>

                <!-- Completed Orders -->
                <div class="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Selesai</h3>
                        <span class="text-3xl">‚úÖ</span>
                    </div>
                    <p class="text-3xl font-bold text-purple-600" id="stat-completed-orders">0</p>
                    <p class="text-xs text-gray-500 mt-1">Pesanan selesai</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Management Section -->
    <section class="py-16 bg-green-50">
        <div class="container mx-auto px-4">
            <!-- Search and Filter Bar -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                    <h3 class="text-2xl font-bold text-green-800">Manajemen Pesanan</h3>
                    
                    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                        <!-- Search Box -->
                        <div class="relative flex-1 md:w-64">
                            <input type="text" id="search-order" placeholder="Cari Order ID atau Email..." 
                                class="w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors">
                            <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>

                        <!-- Status Filter -->
                        <select id="filter-status" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors">
                            <option value="">Semua Status</option>
                            <option value="process">Proses</option>
                            <option value="packing">Sedang Dikemas</option>
                            <option value="shipping">Pengiriman</option>
                            <option value="delivered">Sampai Tujuan</option>
                            <option value="completed">Selesai</option>
                            <option value="cancelled">Dibatalkan</option>
                        </select>

                        <!-- Payment Filter -->
                        <select id="filter-payment" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors">
                            <option value="">Semua Pembayaran</option>
                            <option value="paid">Sudah Bayar</option>
                            <option value="pending">Belum Bayar</option>
                        </select>

                        <!-- Export Button -->
                        <button onclick="exportToCSV()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2 whitespace-nowrap">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Export CSV
                        </button>
                    </div>
                </div>
            </div>

            <!-- Orders List -->
            <div id="orders-list" class="space-y-6">
                <!-- Orders will be populated here -->
            </div>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-4 text-center mt-auto">
        <p>¬© 2017 Teluge Agro. All rights reserved.</p>
    </footer>

    <!-- Admin Account Button -->
    <button id="accountBtn" aria-label="Account Menu" title="Account Menu" class="fixed bottom-4 left-4 bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition z-50 flex items-center justify-center">
        <svg fill="none" viewBox="0 0 24 24" aria-hidden="true" class="w-6 h-6">
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M5 21c0-3 6-3 7-3s7 0 7 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>


    <!-- Admin Panel Popup -->
    <div id="adminMenu" class="hidden fixed bottom-0 left-0 right-0 md:bottom-16 md:left-4 md:right-auto bg-white rounded-lg shadow-xl border border-gray-200 z-40 w-full md:w-64">
        <div id="adminMenuContent">
            <!-- Dynamic content will be inserted here -->
        </div>
    </div>

    <!-- Product Management Section (Hidden by default) -->
    <section id="productManagement" class="py-16 bg-green-50 hidden">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-3xl font-semibold text-green-800">Product Management</h3>
                <button id="addProductBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Tambahin Produk</button>
            </div>
            <div id="products-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Products will be populated here -->
            </div>
        </div>
    </section>

    <!-- Web Content Management Section (Hidden by default) -->
    <section id="webManagement" class="py-16 bg-green-50 hidden">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-3xl font-semibold text-green-800">Web Content Management</h3>
                <div class="flex gap-2">
                    <button id="editWebBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Edit Content</button>
                    <button id="saveWebBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 hidden">Save Changes</button>
                    <button id="cancelWebBtn" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 hidden">Cancel</button>
                </div>
            </div>
            <div id="webContent" class="space-y-8">
                <!-- Web content will be loaded here -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h4 class="text-xl font-bold text-green-700 mb-4">Hero Section</h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Page Title</label>
                            <div id="pageTitleDisplay" class="p-2 border rounded bg-gray-50" contenteditable="false">Teluge Agro - Sustainable Agriculture</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hero Title</label>
                            <div id="heroTitleDisplay" class="p-2 border rounded bg-gray-50" contenteditable="false">Welcome to Teluge Agro</div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hero Description</label>
                        <div id="heroDescriptionDisplay" class="p-2 border rounded bg-gray-50" contenteditable="false">Discover our premium agricultural products and sustainable farming solutions.</div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hero Image</label>
                        <div class="relative">
                            <img id="heroImageDisplay" src="https://via.placeholder.com/800x400?text=Hero+Image" alt="Hero Image" class="w-full h-48 object-cover rounded">
                            <input type="url" id="heroImageInput" class="mt-2 block w-full border border-gray-300 rounded-md shadow-sm p-2 hidden" placeholder="Enter image URL">
                        </div>
                    </div>
                </div>
                <!-- Add more sections as needed -->
            </div>
        </div>
    </section>

    <!-- Product Edit Modal -->
    <div id="productModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-60">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <h2 id="productModalTitle" class="text-lg font-bold mb-4 text-green-700">Edit Product</h2>
            <form id="productForm">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Left Column - Form Fields -->
                    <div class="space-y-4">
                        <div>
                            <label for="productTitle" class="block text-sm font-medium text-gray-700">Title</label>
                            <input type="text" id="productTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                        </div>
                        <div>
                            <label for="productDescription" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="productDescription" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" rows="3" required></textarea>
                        </div>
                        <div>
                            <label for="productPrice" class="block text-sm font-medium text-gray-700">Price ($)</label>
                            <input type="number" id="productPrice" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                        </div>
                        <div>
                            <label for="productImage" class="block text-sm font-medium text-gray-700">Image URL</label>
                            <input type="url" id="productImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required placeholder="https://example.com/image.jpg">
                        </div>

                        <!-- Image Sizing Controls -->
                        <div class="border-t pt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">Image Display Settings</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label for="imageWidth" class="block text-xs text-gray-600">Width (px)</label>
                                    <input type="number" id="imageWidth" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="300" min="50" max="800">
                                </div>
                                <div>
                                    <label for="imageHeight" class="block text-xs text-gray-600">Height (px)</label>
                                    <input type="number" id="imageHeight" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="200" min="50" max="600">
                                </div>
                            </div>
                            <div class="mt-3">
                                <label for="imageFit" class="block text-xs text-gray-600">Object Fit</label>
                                <select id="imageFit" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm">
                                    <option value="cover">Cover (fill area)</option>
                                    <option value="contain">Contain (show full image)</option>
                                    <option value="fill">Fill (stretch)</option>
                                    <option value="none">None (original size)</option>
                                    <option value="scale-down">Scale Down</option>
                                </select>
                            </div>

                            <!-- Advanced Positioning Controls -->
                            <div class="mt-4 border-t pt-3">
                                <h4 class="text-xs font-medium text-gray-600 mb-2">Advanced Positioning</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label for="imagePositionX" class="block text-xs text-gray-600">Horizontal Position</label>
                                        <select id="imagePositionX" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm">
                                            <option value="left">Left</option>
                                            <option value="center">Center</option>
                                            <option value="right">Right</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="imagePositionY" class="block text-xs text-gray-600">Vertical Position</label>
                                        <select id="imagePositionY" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm">
                                            <option value="top">Top</option>
                                            <option value="center">Center</option>
                                            <option value="bottom">Bottom</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Custom Position Sliders -->
                                <div class="mt-3">
                                    <label class="block text-xs text-gray-600 mb-2">Custom Position (for Cover mode)</label>
                                    <div class="space-y-2">
                                        <div>
                                            <label for="positionXSlider" class="block text-xs text-gray-500">X Position: <span id="positionXValue">50</span>%</label>
                                            <input type="range" id="positionXSlider" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                        <div>
                                            <label for="positionYSlider" class="block text-xs text-gray-500">Y Position: <span id="positionYValue">50</span>%</label>
                                            <input type="range" id="positionYSlider" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                        </div>
                                    </div>
                                </div>

                                <!-- Crop Controls -->
                                <div class="mt-3">
                                    <label class="block text-xs text-gray-600 mb-2">Crop Settings</label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label for="cropX" class="block text-xs text-gray-500">Crop X (%)</label>
                                            <input type="number" id="cropX" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="0" min="0" max="100">
                                        </div>
                                        <div>
                                            <label for="cropY" class="block text-xs text-gray-500">Crop Y (%)</label>
                                            <input type="number" id="cropY" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="0" min="0" max="100">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3 mt-2">
                                        <div>
                                            <label for="cropWidth" class="block text-xs text-gray-500">Crop Width (%)</label>
                                            <input type="number" id="cropWidth" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="100" min="10" max="100">
                                        </div>
                                        <div>
                                            <label for="cropHeight" class="block text-xs text-gray-500">Crop Height (%)</label>
                                            <input type="number" id="cropHeight" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm" placeholder="100" min="10" max="100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Image Preview -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Image Preview</label>
                            <div class="mt-1 border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-50">
                                <div id="imagePreviewContainer" class="flex items-center justify-center min-h-[200px] bg-white rounded border">
                                    <div id="imagePreviewPlaceholder" class="text-center text-gray-500">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </svg>
                                        <p class="mt-2 text-sm">Enter image URL to see preview</p>
                                    </div>
                                    <img id="imagePreview" class="hidden max-w-full max-h-full rounded" alt="Product preview">
                                </div>
                            </div>
                        </div>

                        <!-- Preview Info -->
                        <div id="previewInfo" class="text-xs text-gray-600 bg-blue-50 p-3 rounded hidden">
                            <p><strong>Preview Size:</strong> <span id="previewSize">300x200</span>px</p>
                            <p><strong>Object Fit:</strong> <span id="previewFit">cover</span></p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                    <button type="button" id="cancelProductBtn" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Web Management Modal -->
    <div id="webModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-60">
        <div class="bg-white rounded-lg shadow-lg p-6 w-96 max-w-full">
            <h2 id="webModalTitle" class="text-lg font-bold mb-4 text-green-700">Manage Web Content</h2>
            <form id="webForm">
                <div class="mb-4">
                    <label for="pageTitle" class="block text-sm font-medium text-gray-700">Page Title</label>
                    <input type="text" id="pageTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                </div>
                <div class="mb-4">
                    <label for="heroTitle" class="block text-sm font-medium text-gray-700">Hero Title</label>
                    <input type="text" id="heroTitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                </div>
                <div class="mb-4">
                    <label for="heroDescription" class="block text-sm font-medium text-gray-700">Hero Description</label>
                    <textarea id="heroDescription" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" rows="3" required></textarea>
                </div>
                <div class="mb-4">
                    <label for="heroImage" class="block text-sm font-medium text-gray-700">Hero Image URL</label>
                    <input type="url" id="heroImage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                </div>
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancelWebBtn" class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import {
            getFirestore,
            collection,
            getDocs,
            query,
            orderBy,
            addDoc,
            updateDoc,
            deleteDoc,
            doc,
            getDoc,
            onSnapshot
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB2sLqWwZIxr65c3CcNgKCCjmDTeDlSnfY",
            authDomain: "telugeagro2025.firebaseapp.com",
            projectId: "telugeagro2025",
            storageBucket: "telugeagro2025.firebasestorage.app",
            messagingSenderId: "1029963109637",
            appId: "1:1029963109637:web:86824d0db45e1489b3136c",
            measurementId: "G-XF1JDPME66"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }

        // Global variable to store all orders
        let allOrders = [];

        async function loadOrders() {
            try {
                const ordersQuery = query(collection(db, 'orders'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(ordersQuery);
                const ordersList = document.getElementById('orders-list');
                ordersList.innerHTML = '';

                allOrders = [];
                let pendingCount = 0;
                let completedCount = 0;
                let totalRevenue = 0;

                querySnapshot.forEach((doc) => {
                    const order = doc.data();
                    allOrders.push({ id: doc.id, ...order });
                    
                    const status = order.status || 'pending';
                    
                    // Count statistics
                    if (status === 'process' || status === 'pending') {
                        pendingCount++;
                    }
                    if (status === 'completed' || status === 'delivered') {
                        completedCount++;
                    }
                    if (order.paymentStatus === 'paid') {
                        totalRevenue += order.total || 0;
                    }
                });

                // Update dashboard statistics
                updateDashboardStats(allOrders.length, pendingCount, totalRevenue, completedCount);

                // Render orders
                renderOrders(allOrders);
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('orders-list').innerHTML = '<p class="text-red-500">Error loading orders.</p>';
            }
        }

        // Function to update pending orders count display
        function updatePendingOrdersCount(count) {
            const countElement = document.getElementById('pending-orders-count');
            if (countElement) {
                countElement.textContent = count;
                // Hide the count if it's 0
                if (count === 0) {
                    countElement.style.display = 'none';
                } else {
                    countElement.style.display = 'flex';
                }
            }
        }

        // Load orders on page load
        loadOrders();

        // Admin state management
        const ADMIN_USERNAME = 'teluge@admin.app';
        const ADMIN_PASSWORD = 'teluge2025';

        function isLoggedIn() {
            return localStorage.getItem('adminLoggedIn') === 'true';
        }

        function showAdminMenu() {
            const adminMenu = document.getElementById('adminMenu');
            const menuContent = document.getElementById('adminMenuContent');

            if (isLoggedIn()) {
                // Show full admin menu
                menuContent.innerHTML = `
                    <div class="p-4 border-b border-gray-100">
                        <p class="text-sm font-semibold text-gray-800">TelugeAgro_Admin</p>
                        <p class="text-xs text-gray-400">Admin Panel</p>
                    </div>
                    <div class="flex flex-col">
                        <button onclick="manageProducts()"
                            class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3a.75.75 0 01.75.75V6a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75V3.75A.75.75 0 016 3h3.75zM18 3.75A.75.75 0 0017.25 3H13.5a.75.75 0 00-.75.75V6a.75.75 0 00.75.75h3.75A.75.75 0 0018 6V3.75zM9.75 13.5a.75.75 0 01.75.75V18a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75v-3.75A.75.75 0 016 13.5h3.75zM18 13.5a.75.75 0 00-.75.75V18a.75.75 0 00.75.75h3.75a.75.75 0 00.75-.75v-3.75a.75.75 0 00-.75-.75H18z"/>
                            </svg>
                            Manage Products
                        </button>
                        <button onclick="manageOrders()"
                            class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h4l3 8 4-16 3 8h4" />
                            </svg>
                            Pesanan
                        </button>
                        <button onclick="manageWeb()"
                            class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-green-50 hover:text-green-600 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            Manage Web
                        </button>
                        <button onclick="logoutAdminKeepLogo()"
                            class="flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-9A2.25 2.25 0 002.25 5.25v13.5A2.25 2.25 0 004.5 21h9a2.25 2.25 0 002.25-2.25V15M12 9l3-3m0 0l3 3m-3-3v12"/>
                            </svg>
                            Logout
                        </button>
                    </div>
                `;
            } else {
                // Show login form for non-admin users
                menuContent.innerHTML = `
                    <div class="p-4 border-b border-gray-100">
                        <p class="text-sm font-semibold text-gray-800">Admin Login</p>
                        <p class="text-xs text-gray-400">Masuk untuk mengakses panel admin</p>
                    </div>
                    <form id="adminLoginForm" class="p-4 space-y-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Username</label>
                            <input type="text" id="adminUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="teluge@admin.app" required>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">Password</label>
                            <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="teluge2025" required>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition-colors text-sm font-medium">Login</button>
                        <div id="loginError" class="hidden text-red-500 text-xs text-center mt-2">Username atau password salah!</div>
                    </form>
                `;
                // Add event listener for login form
                document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const username = document.getElementById('adminUsername').value;
                    const password = document.getElementById('adminPassword').value;
                    if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                        localStorage.setItem('adminLoggedIn', 'true');
                        showToast('Login admin berhasil!', 'success');
                        hideAdminMenu();
                        showAdminMenu(); // Refresh menu
                        loadOrders(); // Load orders after login
                    } else {
                        document.getElementById('loginError').classList.remove('hidden');
                    }
                });
            }

            adminMenu.classList.remove('hidden');
        }

        function hideAdminMenu() {
            const adminMenu = document.getElementById('adminMenu');
            adminMenu.classList.add('hidden');
        }

        function toggleAdminMenu() {
            const adminMenu = document.getElementById('adminMenu');
            if (adminMenu.classList.contains('hidden')) {
                showAdminMenu();
            } else {
                hideAdminMenu();
            }
        }

        // Account button event listener
        document.getElementById('accountBtn').addEventListener('click', () => {
            // Show admin menu popup directly regardless of login state
            toggleAdminMenu();
        });

        // Close admin menu when clicking outside
        document.addEventListener('click', (e) => {
            const adminMenu = document.getElementById('adminMenu');
            const accountBtn = document.getElementById('accountBtn');
            if (!adminMenu.contains(e.target) && !accountBtn.contains(e.target)) {
                hideAdminMenu();
            }
        });

        // Manage Web function
        function manageWeb() {
            const webManagement = document.getElementById('webManagement');
            const productManagement = document.getElementById('productManagement');
            const orderManagement = document.querySelector('section.py-16.bg-green-50');

            // Hide other sections
            productManagement.classList.add('hidden');
            orderManagement.style.display = 'none';

            // Show web management
            webManagement.classList.remove('hidden');
            loadWebContent();
            hideAdminMenu();
        }

        // Logout function
        function logoutAdmin() {
            localStorage.removeItem('adminLoggedIn');
            hideAdminMenu();
            // Redirect to main page since we use popup modals
            window.location.href = 'leadingpage.html';
        }

        // Logout function that keeps logo
        function logoutAdminKeepLogo() {
            logoutAdmin();
            // Show account button after logout
            const accountBtn = document.getElementById('accountBtn');
            if (accountBtn) {
                accountBtn.style.display = 'flex';
            }
        }

        // Manage Products function
        function manageProducts() {
            const productManagement = document.getElementById('productManagement');
            const orderManagement = document.querySelector('section.py-16.bg-green-50');

            if (productManagement.classList.contains('hidden')) {
                // Show product management, hide order management
                productManagement.classList.remove('hidden');
                orderManagement.style.display = 'none';
                loadProducts();
            } else {
                // Show order management, hide product management
                productManagement.classList.add('hidden');
                orderManagement.style.display = 'block';
            }
            hideAdminMenu();
        }

        // Manage Orders function
        function manageOrders() {
            const productManagement = document.getElementById('productManagement');
            const orderManagement = document.querySelector('section.py-16.bg-green-50');

            // Show order management, hide product management
            productManagement.classList.add('hidden');
            orderManagement.style.display = 'block';
            hideAdminMenu();
        }

        // Product management functions
        async function loadProducts() {
            try {
                const productsQuery = query(collection(db, 'products'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(productsQuery);
                const productsList = document.getElementById('products-list');
                productsList.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const product = doc.data();
                    const productDiv = document.createElement('div');
                    productDiv.className = 'bg-white p-6 rounded-lg shadow-lg';
                    productDiv.innerHTML = `
                        <img src="${product.image}" alt="${product.title}" class="w-full h-48 object-cover rounded mb-4">
                        <h4 class="text-xl font-bold text-green-700 mb-2">${product.title}</h4>
                        <p class="text-gray-600 mb-4">${product.description}</p>
                        <p class="text-lg font-semibold text-green-600 mb-4">Rp. ${product.price === 0 ? '0' : product.price.toFixed(0)}</p>
<label class="inline-flex items-center space-x-2 mb-4 cursor-pointer">
    <input type="checkbox" class="featured-checkbox" data-id="${doc.id}" ${product.featured ? 'checked' : ''} style="opacity: 0; position: absolute; width: 1.25rem; height: 1.25rem; cursor: pointer;">
    <span class="custom-checkbox w-5 h-5 inline-block border-2 border-green-400 rounded-sm relative flex-shrink-0"></span>
    <span class="text-gray-700 font-semibold ml-2 align-middle">Produk Unggulan</span>
    <style>
        .custom-checkbox {
            background-color: white;
        }
        input.featured-checkbox:checked + .custom-checkbox {
            background-color: #4ade80;
            border-color: #4ade80;
        }
        input.featured-checkbox:checked + .custom-checkbox::after {
            content: '\\2713';
            color: white;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1rem;
            pointer-events: none;
        }
    </style>
</label>
                        <div class="flex gap-2">
                            <button onclick="editProduct('${doc.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Edit</button>
                            <button onclick="deleteProduct('${doc.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Delete</button>
                        </div>
                    `;
                    productsList.appendChild(productDiv);
                });

                // Add event listeners for featured checkboxes
                document.querySelectorAll('.featured-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', async (e) => {
                        const productId = e.target.dataset.id;
                        const isFeatured = e.target.checked;
                        await toggleFeatured(productId, isFeatured);
                    });
                });
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-list').innerHTML = '<p class="text-red-500">Error loading products.</p>';
            }
        }

        // Function to toggle featured status
        async function toggleFeatured(productId, isFeatured) {
            try {
                await updateDoc(doc(db, 'products', productId), {
                    featured: isFeatured,
                    updatedAt: new Date()
                });
                showToast(`Product ${isFeatured ? 'marked as featured' : 'unmarked as featured'}`, 'success');
            } catch (error) {
                console.error('Error updating featured status:', error);
                showToast('Error updating featured status', 'error');
                // Reload products to revert checkbox state
                loadProducts();
            }
        }

        async function addProduct() {
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').classList.remove('hidden');
        }

        async function editProduct(productId) {
            try {
                const productDoc = await getDoc(doc(db, 'products', productId));
                if (productDoc.exists()) {
                    const product = productDoc.data();
                    document.getElementById('productTitle').value = product.title;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productImage').value = product.image;
                    document.getElementById('productModalTitle').textContent = 'Edit Product';
                    document.getElementById('productForm').dataset.productId = productId;
                    document.getElementById('productModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading product for edit:', error);
            }
        }

        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    await deleteDoc(doc(db, 'products', productId));
                    loadProducts()
                } catch (error) {
                    console.error('Error deleting product:', error);
                }
            }
        }

        // Product form submission
        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('productTitle').value;
            const description = document.getElementById('productDescription').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const image = document.getElementById('productImage').value;
            const productId = document.getElementById('productForm').dataset.productId;

            try {
                if (productId) {
                    // Update existing product
                    await updateDoc(doc(db, 'products', productId), {
                        title,
                        description,
                        price,
                        image,
                        updatedAt: new Date()
                    });
                } else {
                    // Add new product
                    await addDoc(collection(db, 'products'), {
                        title,
                        description,
                        price,
                        image,
                        createdAt: new Date()
                    });
                }

                document.getElementById('productModal').classList.add('hidden');
                loadProducts();
            } catch (error) {
                console.error('Error saving product:', error);
            }
        });

        // Modal event listeners
        document.getElementById('cancelProductBtn').addEventListener('click', () => {
            document.getElementById('productModal').classList.add('hidden');
        });

        document.getElementById('addProductBtn').addEventListener('click', addProduct);

        // Close modal when clicking outside
        document.getElementById('productModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('productModal')) {
                document.getElementById('productModal').classList.add('hidden');
            }
        });

        // Update order status
        async function updateOrderStatus(orderId, newStatus) {
            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    status: newStatus,
                    updatedAt: new Date()
                });
                loadOrders(); // Reload orders to reflect changes
                showToast(`Order status updated to ${newStatus}`, 'success');
            } catch (error) {
                console.error('Error updating order status:', error);
                showToast('Error updating order status', 'error');
            }
        }

        // Update payment status
        async function updatePaymentStatus(orderId, newPaymentStatus) {
            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    paymentStatus: newPaymentStatus,
                    updatedAt: new Date()
                });
                loadOrders(); // Reload orders to reflect changes

                // Show appropriate notification based on payment status
                if (newPaymentStatus === 'paid') {
                    showToast('Status pembayaran berhasil diupdate menjadi SUDAH BAYAR', 'success');
                } else {
                    showToast('Status pembayaran berhasil diupdate menjadi BELUM BAYAR', 'success');
                }
            } catch (error) {
                console.error('Error updating payment status:', error);
                showToast('Error updating payment status', 'error');
            }
        }

        // Delete order
        async function deleteOrder(orderId) {
            console.log('deleteOrder called with orderId:', orderId);
            if (confirm('Are you sure you want to delete this order? This action cannot be undone.')) {
                console.log('User confirmed deletion');
                try {
                    console.log('Attempting to delete doc:', orderId);
                    await deleteDoc(doc(db, 'orders', orderId));
                    console.log('Doc deleted successfully');
                    loadOrders(); // Reload orders to reflect changes
                    showToast('Order deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting order:', error);
                    showToast('Error deleting order', 'error');
                }
            } else {
                console.log('User cancelled deletion');
            }
        }
        window.deleteOrder = deleteOrder;

        // Web content management functions
        async function loadWebContent() {
            try {
                const webContentDoc = await getDoc(doc(db, 'webContent', 'main'));
                if (webContentDoc.exists()) {
                    const content = webContentDoc.data();
                    document.getElementById('pageTitleDisplay').textContent = content.pageTitle || 'Teluge Agro - Sustainable Agriculture';
                    document.getElementById('heroTitleDisplay').textContent = content.heroTitle || 'Welcome to Teluge Agro';
                    document.getElementById('heroDescriptionDisplay').textContent = content.heroDescription || 'Discover our premium agricultural products and sustainable farming solutions.';
                    document.getElementById('heroImageDisplay').src = content.heroImage || 'https://via.placeholder.com/800x400?text=Hero+Image';
                } else {
                    // Load default content
                    document.getElementById('pageTitleDisplay').textContent = 'Teluge Agro - Sustainable Agriculture';
                    document.getElementById('heroTitleDisplay').textContent = 'Welcome to Teluge Agro';
                    document.getElementById('heroDescriptionDisplay').textContent = 'Discover our premium agricultural products and sustainable farming solutions.';
                    document.getElementById('heroImageDisplay').src = 'https://via.placeholder.com/800x400?text=Hero+Image';
                }
            } catch (error) {
                console.error('Error loading web content:', error);
                showToast('Error loading web content', 'error');
            }
        }

        async function saveWebContent() {
            try {
                const content = {
                    pageTitle: document.getElementById('pageTitleDisplay').textContent,
                    heroTitle: document.getElementById('heroTitleDisplay').textContent,
                    heroDescription: document.getElementById('heroDescriptionDisplay').textContent,
                    heroImage: document.getElementById('heroImageDisplay').src,
                    updatedAt: new Date()
                };

                await setDoc(doc(db, 'webContent', 'main'), content);
                showToast('Web content saved successfully', 'success');
                exitEditMode();
            } catch (error) {
                console.error('Error saving web content:', error);
                showToast('Error saving web content', 'error');
            }
        }

        function enterEditMode() {
            // Make content editable
            document.getElementById('pageTitleDisplay').contentEditable = 'true';
            document.getElementById('heroTitleDisplay').contentEditable = 'true';
            document.getElementById('heroDescriptionDisplay').contentEditable = 'true';

            // Show image input
            document.getElementById('heroImageInput').classList.remove('hidden');
            document.getElementById('heroImageInput').value = document.getElementById('heroImageDisplay').src;

            // Show save and cancel buttons
            document.getElementById('saveWebBtn').classList.remove('hidden');
            document.getElementById('cancelWebBtn').classList.remove('hidden');
            document.getElementById('editWebBtn').classList.add('hidden');

            // Add styling for editable content
            const editableElements = ['pageTitleDisplay', 'heroTitleDisplay', 'heroDescriptionDisplay'];
            editableElements.forEach(id => {
                document.getElementById(id).classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
            });
        }

        function exitEditMode() {
            // Make content non-editable
            document.getElementById('pageTitleDisplay').contentEditable = 'false';
            document.getElementById('heroTitleDisplay').contentEditable = 'false';
            document.getElementById('heroDescriptionDisplay').contentEditable = 'false';

            // Hide image input
            document.getElementById('heroImageInput').classList.add('hidden');

            // Show edit button, hide save and cancel buttons
            document.getElementById('editWebBtn').classList.remove('hidden');
            document.getElementById('saveWebBtn').classList.add('hidden');
            document.getElementById('cancelWebBtn').classList.add('hidden');

            // Remove styling for editable content
            const editableElements = ['pageTitleDisplay', 'heroTitleDisplay', 'heroDescriptionDisplay'];
            editableElements.forEach(id => {
                document.getElementById(id).classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50');
            });
        }

        function cancelEdit() {
            // Reload content to discard changes
            loadWebContent();
            exitEditMode();
        }

        // Event listeners for web content management
        document.getElementById('editWebBtn').addEventListener('click', enterEditMode);
        document.getElementById('saveWebBtn').addEventListener('click', saveWebContent);
        document.getElementById('cancelWebBtn').addEventListener('click', cancelEdit);

        // Update hero image when input changes
        document.getElementById('heroImageInput').addEventListener('input', function() {
            document.getElementById('heroImageDisplay').src = this.value;
        });

        // Update Dashboard Statistics
        function updateDashboardStats(total, pending, revenue, completed) {
            document.getElementById('stat-total-orders').textContent = total;
            document.getElementById('stat-pending-orders').textContent = pending;
            document.getElementById('stat-total-revenue').textContent = `Rp ${formatPrice(revenue)}`;
            document.getElementById('stat-completed-orders').textContent = completed;
        }

        // Render orders function with new UI
        function renderOrders(orders) {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<div class="text-center py-12 text-gray-500"><p class="text-xl">Belum ada pesanan</p></div>';
                return;
            }

            ordersList.innerHTML = orders.map((order) => {
                const status = order.status || 'process';
                const statusColor = status === 'completed' ? 'bg-green-100 text-green-800 border-green-500' :
                                   status === 'cancelled' ? 'bg-red-100 text-red-800 border-red-500' :
                                   status === 'process' ? 'bg-yellow-100 text-yellow-800 border-yellow-500' :
                                   status === 'packing' ? 'bg-orange-100 text-orange-800 border-orange-500' :
                                   status === 'shipping' ? 'bg-blue-100 text-blue-800 border-blue-500' :
                                   status === 'delivered' ? 'bg-purple-100 text-purple-800 border-purple-500' :
                                   'bg-gray-100 text-gray-800 border-gray-500';

                // Helper function to format address
                function formatAddress(order) {
                    const addressFields = [
                        order.shippingAddress,
                        order.deliveryAddress,
                        order.address,
                        order.customerAddress
                    ];

                    for (const addr of addressFields) {
                        if (addr) {
                            if (typeof addr === 'string') {
                                return addr;
                            } else if (typeof addr === 'object') {
                                const parts = [];
                                if (addr.street) parts.push(addr.street);
                                if (addr.city) parts.push(addr.city);
                                if (addr.province) parts.push(addr.province);
                                if (addr.postalCode) parts.push(addr.postalCode);
                                if (addr.country) parts.push(addr.country);
                                return parts.join(', ');
                            }
                        }
                    }
                    return 'N/A';
                }

                return `
                    <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 ${statusColor.split(' ')[2]}">
                        <div class="flex flex-col lg:flex-row justify-between items-start gap-4 mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h4 class="text-xl font-bold text-green-700">Order ID: ${order.id}</h4>
                                    <button onclick="copyToClipboard('${order.id}')" class="text-gray-400 hover:text-green-600 transition-colors" title="Copy Order ID">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                        </svg>
                                    </button>
                                    <a href="profil.html?preview=${order.id}" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm flex items-center gap-1" title="Preview as Customer">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                        Preview
                                    </a>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                    <p class="text-gray-600"><strong>Customer:</strong> ${order.customerName || order.name}</p>
                                    <p class="text-gray-600"><strong>Email:</strong> ${order.email}</p>
                                    <p class="text-gray-600"><strong>Phone:</strong> ${order.phone || 'N/A'}</p>
                                    <p class="text-gray-600"><strong>Date:</strong> ${order.timestamp.toDate().toLocaleString('id-ID')}</p>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold ${statusColor}">
                                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                                </span>
                                <span class="text-2xl font-bold text-green-600">Rp. ${order.total.toFixed(0)}</span>
                            </div>
                        </div>

                        <p class="text-gray-600 mb-4 text-sm"><strong>Address:</strong> ${formatAddress(order)}</p>

                        <!-- Shipping Information Section -->
                        <div class="bg-blue-50 rounded-lg p-4 mb-4">
                            <h5 class="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Informasi Pengiriman
                            </h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Nama Kurir</label>
                                    <input type="text" id="courier-${order.id}" value="${order.courierName || ''}" 
                                        placeholder="JNE, TIKI, JNT, dll" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Nomor Resi</label>
                                    <input type="text" id="tracking-${order.id}" value="${order.trackingNumber || ''}" 
                                        placeholder="Masukkan no. resi" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Estimasi Tiba</label>
                                    <input type="text" id="estimated-${order.id}" value="${order.estimatedDelivery || ''}" 
                                        placeholder="2-3 hari" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            <button onclick="updateShippingInfo('${order.id}')" 
                                class="mt-3 w-full md:w-auto bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Simpan Informasi Pengiriman
                            </button>
                        </div>

                        <!-- Order Status Update Section -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Update Status Pesanan:</label>
                            <div class="flex gap-2 flex-wrap">
                                <button onclick="updateOrderStatus('${order.id}', 'process')" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm font-medium">Proses</button>
                                <button onclick="updateOrderStatus('${order.id}', 'packing')" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm font-medium">Sedang Dikemas</button>
                                <button onclick="updateOrderStatus('${order.id}', 'shipping')" class="px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 text-sm font-medium">Pengiriman</button>
                                <button onclick="updateOrderStatus('${order.id}', 'delivered')" class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 text-sm font-medium">Sampai Tujuan</button>
                                <button onclick="updateOrderStatus('${order.id}', 'completed')" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm font-medium">Selesai</button>
                                <button onclick="updateOrderStatus('${order.id}', 'cancelled')" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm font-medium">Batal</button>
                                <button onclick="deleteOrder('${order.id}')" class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm font-medium">Hapus</button>
                            </div>
                        </div>

                        <!-- Payment Status Update Section -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Update Status Pembayaran:</label>
                            <div class="flex gap-2 flex-wrap">
                                <button onclick="updatePaymentStatus('${order.id}', 'paid')" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-sm font-medium flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Tandai Sudah Bayar
                                </button>
                                <button onclick="updatePaymentStatus('${order.id}', 'pending')" class="px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 text-sm font-medium flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    Tandai Belum Bayar
                                </button>
                            </div>
                        </div>

                        <!-- Payment Status Display -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status Pembayaran Saat Ini:</label>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full ${order.paymentStatus === 'paid' ? 'bg-green-500' : 'bg-orange-500'}"></div>
                                <span class="text-sm font-medium ${order.paymentStatus === 'paid' ? 'text-green-700' : 'text-orange-700'}">
                                    ${order.paymentStatus === 'paid' ? 'Sudah Dibayar' : 'Belum Dibayar'}
                                </span>
                                ${order.paymentStatus === 'paid' ? '<span class="text-xs text-green-600 ml-2">‚úì Pembayaran diterima</span>' : '<span class="text-xs text-orange-600 ml-2">Menunggu pembayaran</span>'}
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="space-y-2">
                            ${order.items.map(item => `
                                <div class="flex justify-between text-sm bg-gray-50 p-2 rounded">
                                    <span>${item.product} (x${item.quantity})</span>
                                    <span>Rp. ${(item.price * item.quantity).toFixed(0)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update shipping information
        async function updateShippingInfo(orderId) {
            const courierName = document.getElementById(`courier-${orderId}`).value;
            const trackingNumber = document.getElementById(`tracking-${orderId}`).value;
            const estimatedDelivery = document.getElementById(`estimated-${orderId}`).value;

            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    courierName: courierName,
                    trackingNumber: trackingNumber,
                    estimatedDelivery: estimatedDelivery,
                    updatedAt: new Date()
                });
                showToast('Informasi pengiriman berhasil diupdate', 'success');
                
                // Send notification email (EmailJS integration)
                sendShippingNotification(orderId, courierName, trackingNumber, estimatedDelivery);
            } catch (error) {
                console.error('Error updating shipping info:', error);
                showToast('Gagal update informasi pengiriman', 'error');
            }
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Order ID berhasil disalin!', 'success');
            }).catch(() => {
                showToast('Gagal menyalin Order ID', 'error');
            });
        }

        // Format price
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID').format(Math.round(price));
        }

        // Export to CSV
        function exportToCSV() {
            if (allOrders.length === 0) {
                showToast('Tidak ada data untuk di-export', 'error');
                return;
            }

            const csvRows = [];
            const headers = ['Order ID', 'Customer Name', 'Email', 'Phone', 'Total', 'Status', 'Payment Status', 'Date', 'Tracking Number', 'Courier'];
            csvRows.push(headers.join(','));

            allOrders.forEach(order => {
                const row = [
                    order.id,
                    order.customerName || order.name || '',
                    order.email || '',
                    order.phone || '',
                    order.total || 0,
                    order.status || 'pending',
                    order.paymentStatus || 'pending',
                    order.timestamp?.toDate().toLocaleDateString('id-ID') || '',
                    order.trackingNumber || '',
                    order.courierName || ''
                ];
                csvRows.push(row.join(','));
            });

            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `orders_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showToast('Data berhasil di-export!', 'success');
        }

        // Send shipping notification via EmailJS
        function sendShippingNotification(orderId, courier, tracking, estimated) {
            // EmailJS integration will be added here
            console.log('Sending notification for order:', orderId);
            // You can integrate EmailJS here later
        }

        // Search and Filter functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-order');
            const statusFilter = document.getElementById('filter-status');
            const paymentFilter = document.getElementById('filter-payment');

            if (searchInput) {
                searchInput.addEventListener('input', filterOrders);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', filterOrders);
            }
            if (paymentFilter) {
                paymentFilter.addEventListener('change', filterOrders);
            }
        });

        function filterOrders() {
            const searchTerm = document.getElementById('search-order')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('filter-status')?.value || '';
            const paymentFilter = document.getElementById('filter-payment')?.value || '';

            const filteredOrders = allOrders.filter(order => {
                const matchesSearch = !searchTerm || 
                    order.id.toLowerCase().includes(searchTerm) ||
                    (order.email || '').toLowerCase().includes(searchTerm) ||
                    (order.customerName || '').toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || order.status === statusFilter;
                const matchesPayment = !paymentFilter || order.paymentStatus === paymentFilter;

                return matchesSearch && matchesStatus && matchesPayment;
            });

            renderOrders(filteredOrders);
        }

        // Make new functions global
        window.updateShippingInfo = updateShippingInfo;
        window.copyToClipboard = copyToClipboard;
        window.exportToCSV = exportToCSV;
        window.filterOrders = filterOrders;


        // Make functions global - ensure they are available immediately
        window.manageWeb = manageWeb;
        window.logoutAdmin = logoutAdmin;
        window.logoutAdminKeepLogo = logoutAdminKeepLogo;
        window.manageProducts = manageProducts;
        window.manageOrders = manageOrders;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.loadProducts = loadProducts;
        window.moduleUpdateOrderStatus = updateOrderStatus; // Store the real function
        window.updateOrderStatus = updateOrderStatus; // Replace the placeholder
        window.loadOrders = loadOrders;
        window.loadWebContent = loadWebContent;
        window.saveWebContent = saveWebContent;
        window.enterEditMode = enterEditMode;
        window.exitEditMode = exitEditMode;
        window.cancelEdit = cancelEdit;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
        });
    </script>
<script>
      // Hamburger menu toggle
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    hamburgerBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // Close mobile menu when clicking on a link
    mobileMenu.addEventListener('click', (e) => {
      if (e.target.tagName === 'A') {
        mobileMenu.classList.add('hidden');
      }
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!hamburgerBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
        mobileMenu.classList.add('hidden');
      }
    });

    // Initialize the app
    // Note: loadCart() removed as it's not defined in this file
    // Popup click event removed as cart-popup element may not exist in admin.html

    // Global updateOrderStatus function - will be replaced by module version when loaded
    window.updateOrderStatus = async function(orderId, newStatus) {
        // Show loading state
        console.log(`Updating order ${orderId} to ${newStatus}...`);

        // If module version is available, use it
        if (window.moduleUpdateOrderStatus) {
            return window.moduleUpdateOrderStatus(orderId, newStatus);
        }

        // Fallback: show message that function is loading
        alert('Please wait for the page to fully load before updating orders.');
    };

    // Image preview and sizing functionality
    function initializeImagePreview() {
        const imageUrlInput = document.getElementById('productImage');
        const imageWidthInput = document.getElementById('imageWidth');
        const imageHeightInput = document.getElementById('imageHeight');
        const imageFitSelect = document.getElementById('imageFit');
        const imagePositionX = document.getElementById('imagePositionX');
        const imagePositionY = document.getElementById('imagePositionY');
        const positionXSlider = document.getElementById('positionXSlider');
        const positionYSlider = document.getElementById('positionYSlider');
        const positionXValue = document.getElementById('positionXValue');
        const positionYValue = document.getElementById('positionYValue');
        const cropX = document.getElementById('cropX');
        const cropY = document.getElementById('cropY');
        const cropWidth = document.getElementById('cropWidth');
        const cropHeight = document.getElementById('cropHeight');
        const imagePreview = document.getElementById('imagePreview');
        const imagePreviewPlaceholder = document.getElementById('imagePreviewPlaceholder');
        const previewInfo = document.getElementById('previewInfo');
        const previewSize = document.getElementById('previewSize');
        const previewFit = document.getElementById('previewFit');

        function updatePreview() {
            const url = imageUrlInput.value.trim();
            const width = imageWidthInput.value || 300;
            const height = imageHeightInput.value || 200;
            const fit = imageFitSelect.value || 'cover';
            const posX = imagePositionX.value || 'center';
            const posY = imagePositionY.value || 'center';
            const customX = positionXSlider.value || 50;
            const customY = positionYSlider.value || 50;
            const cropXVal = cropX.value || 0;
            const cropYVal = cropY.value || 0;
            const cropWVal = cropWidth.value || 100;
            const cropHVal = cropHeight.value || 100;

            if (url) {
                // Show preview
                imagePreview.src = url;
                imagePreview.style.width = width + 'px';
                imagePreview.style.height = height + 'px';
                imagePreview.style.objectFit = fit;

                // Apply positioning
                if (fit === 'cover') {
                    // Use custom position for cover mode
                    imagePreview.style.objectPosition = `${customX}% ${customY}%`;
                } else {
                    // Use standard position for other modes
                    imagePreview.style.objectPosition = `${posX} ${posY}`;
                }

                // Apply cropping using clip-path
                const clipX = (cropXVal / 100) * width;
                const clipY = (cropYVal / 100) * height;
                const clipW = (cropWVal / 100) * width;
                const clipH = (cropHVal / 100) * height;

                imagePreview.style.clipPath = `inset(${clipY}px ${width - clipX - clipW}px ${height - clipY - clipH}px ${clipX}px)`;

                imagePreview.classList.remove('hidden');
                imagePreviewPlaceholder.classList.add('hidden');

                // Show preview info
                previewSize.textContent = width + 'x' + height;
                previewFit.textContent = fit;
                previewInfo.classList.remove('hidden');

                // Handle image load error
                imagePreview.onerror = function() {
                    imagePreview.classList.add('hidden');
                    imagePreviewPlaceholder.classList.remove('hidden');
                    previewInfo.classList.add('hidden');
                    showToast('Invalid image URL', 'error');
                };

                // Handle successful load
                imagePreview.onload = function() {
                    // Image loaded successfully
                };
            } else {
                // Hide preview
                imagePreview.classList.add('hidden');
                imagePreviewPlaceholder.classList.remove('hidden');
                previewInfo.classList.add('hidden');
            }
        }

        // Update slider values display
        function updateSliderValues() {
            positionXValue.textContent = positionXSlider.value;
            positionYValue.textContent = positionYSlider.value;
        }

        // Add event listeners
        imageUrlInput.addEventListener('input', updatePreview);
        imageWidthInput.addEventListener('input', updatePreview);
        imageHeightInput.addEventListener('input', updatePreview);
        imageFitSelect.addEventListener('change', updatePreview);
        imagePositionX.addEventListener('change', updatePreview);
        imagePositionY.addEventListener('change', updatePreview);
        positionXSlider.addEventListener('input', function() {
            updateSliderValues();
            updatePreview();
        });
        positionYSlider.addEventListener('input', function() {
            updateSliderValues();
            updatePreview();
        });
        cropX.addEventListener('input', updatePreview);
        cropY.addEventListener('input', updatePreview);
        cropWidth.addEventListener('input', updatePreview);
        cropHeight.addEventListener('input', updatePreview);

        // Initialize with default values
        updateSliderValues();
        updatePreview();
    }

    // Initialize image preview when modal is opened
    document.getElementById('addProductBtn').addEventListener('click', function() {
        setTimeout(initializeImagePreview, 100); // Small delay to ensure modal is rendered
    });

    // Also initialize when editing existing product
    window.editProduct = (function(originalEditProduct) {
        return function(productId) {
            originalEditProduct(productId);
            setTimeout(initializeImagePreview, 100);
        };
    })(window.editProduct);

    // Reset preview when modal is closed
    document.getElementById('cancelProductBtn').addEventListener('click', function() {
        const imagePreview = document.getElementById('imagePreview');
        const imagePreviewPlaceholder = document.getElementById('imagePreviewPlaceholder');
        const previewInfo = document.getElementById('previewInfo');

        imagePreview.classList.add('hidden');
        imagePreviewPlaceholder.classList.remove('hidden');
        previewInfo.classList.add('hidden');
    });

    // Also reset when clicking outside modal
    document.getElementById('productModal').addEventListener('click', function(e) {
        if (e.target === this) {
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewPlaceholder = document.getElementById('imagePreviewPlaceholder');
            const previewInfo = document.getElementById('previewInfo');

            imagePreview.classList.add('hidden');
            imagePreviewPlaceholder.classList.remove('hidden');
            previewInfo.classList.add('hidden');
        }
    });

  </script>
    
</body>
</html>
