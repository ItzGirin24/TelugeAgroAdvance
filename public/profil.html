<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - TelugeAgro</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ItzGirin24/TelugeAgro/refs/heads/main/logo%20Teluge.jpg" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2sLqWwZIxr65c3CcNgKCCjmDTeDlSnfY",
            authDomain: "telugeagro2025.firebaseapp.com",
            projectId: "telugeagro2025",
            storageBucket: "telugeagro2025.firebasestorage.app",
            messagingSenderId: "1029963109637",
            appId: "1:1029963109637:web:86824d0db45e1489b3136c",
            measurementId: "G-XF1JDPME66"
        };

        const app = initializeApp(firebaseConfig);
        window.firebaseAuth = getAuth(app);
        window.firebaseDb = getFirestore(app);
        window.doc = doc;
        window.getDoc = getDoc;
        window.collection = collection;
        window.query = query;
        window.where = where;
        window.orderBy = orderBy;
        window.getDocs = getDocs;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            min-height: 100vh;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
        }

        .profile-card {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(34, 197, 94, 0.2);
        }

        .order-item {
            transition: all 0.3s ease;
        }

        .order-item:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-paid {
            background: #d1fae5;
            color: #065f46;
        }

        .status-processing {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-completed {
            background: #f3e8ff;
            color: #7c2d12;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .cart-item {
            background: #f8fafc;
            border-left: 4px solid #22c55e;
        }
    </style>
</head>
<body>
    <!-- Authentication Check -->
    <script>
        // Check authentication first
        if (!localStorage.getItem('adminLoggedIn') && !localStorage.getItem('userLoggedIn')) {
            window.location.href = 'login.html?redirect=profile.html';
        }
    </script>

    <br>
        <br>
            <br>
                <br>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 transition-all duration-300" id="navbar" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 50%, #15803d 100%);">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 md:h-20">
                <!-- Logo -->
                <div class="flex items-center space-x-3 hover-scale">
                    <img src="logo Teluge.jpg" alt="TelugeAgro Logo" class="w-10 h-10 md:w-12 md:h-12 rounded-full pulse-glow">
                    <span class="text-xl md:text-2xl font-bold text-white">TelugeAgro</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="nav-link text-white hover:text-green-200 transition-colors duration-300 font-medium">Beranda</a>
                    <a href="#about" class="nav-link text-white hover:text-green-200 transition-colors duration-300 font-medium">Tentang</a>
                    <a href="#products" class="nav-link text-white hover:text-green-200 transition-colors duration-300 font-medium">Produk</a>
                    <a href="#contact" class="nav-link text-white hover:text-green-200 transition-colors duration-300 font-medium">Kontak</a>
                    <a href="store.html" class="bg-white text-green-600 px-6 py-2 rounded-full font-semibold hover:bg-green-50 transition-all duration-300 btn-shine">
                        Beli Sekarang
                           </a>
                            <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors duration-300 font-medium">
                        Logout
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" aria-controls="mobile-menu" aria-expanded="false" class="md:hidden text-white hover:text-green-200 transition-colors duration-300 cursor-pointer z-50">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu md:hidden absolute top-full left-0 right-0 bg-green-700 border-t border-green-600 z-40">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <a href="#home" class="block px-3 py-2 text-white hover:bg-green-600 rounded transition-colors duration-300">Beranda</a>
                <a href="#about" class="block px-3 py-2 text-white hover:bg-green-600 rounded transition-colors duration-300">Tentang</a>
                <a href="#products" class="block px-3 py-2 text-white hover:bg-green-600 rounded transition-colors duration-300">Produk</a>
                <a href="#contact" class="block px-3 py-2 text-white hover:bg-green-600 rounded transition-colors duration-300">Kontak</a>
                <a href="store.html" class="block px-3 py-2 bg-white text-green-600 rounded font-semibold hover:bg-green-50 transition-colors duration-300 text-center">
                    Beli Sekarang
                </a>
            </div>
        </div>
    </nav>


    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Profile Header -->
            <div class="profile-card rounded-3xl p-8 mb-8" data-aos="fade-down">
                <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                    <div class="relative">
                        <img id="userAvatar" src="" alt="User Avatar" class="w-32 h-32 rounded-full border-4 border-white shadow-xl object-cover">
                        <div class="absolute -bottom-2 -right-2 bg-white rounded-full p-2">
                            <span id="userStatusIcon" class="text-2xl">✅</span>
                        </div>
                    </div>
                    <div class="text-center md:text-left flex-1">
                        <h1 id="userName" class="text-3xl md:text-4xl font-bold mb-2">Loading...</h1>
                        <p id="userEmail" class="text-xl opacity-90 mb-4">Loading...</p>
                        <div class="flex flex-wrap justify-center md:justify-start gap-3">
                            <span id="userRole" class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-semibold">Loading...</span>
                            <span id="memberSince" class="px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-semibold">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8" data-aos="fade-up">
                <div class="stat-card glass-container rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">🛒</div>
                    <div class="text-2xl font-bold text-green-600" id="cartItemsCount">0</div>
                    <div class="text-sm text-gray-600">Item di Keranjang</div>
                </div>
                <div class="stat-card glass-container rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">📦</div>
                    <div class="text-2xl font-bold text-blue-600" id="totalOrders">0</div>
                    <div class="text-sm text-gray-600">Total Pesanan</div>
                </div>
                <div class="stat-card glass-container rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">💰</div>
                    <div class="text-2xl font-bold text-yellow-600" id="totalSpent">Rp 0</div>
                    <div class="text-sm text-gray-600">Total Belanja</div>
                </div>
                <div class="stat-card glass-container rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">⭐</div>
                    <div class="text-2xl font-bold text-purple-600" id="loyaltyPoints">0</div>
                    <div class="text-sm text-gray-600">Poin Loyalitas</div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="glass-container rounded-2xl overflow-hidden mb-8" data-aos="fade-up" data-aos-delay="200">
                <!-- Tab Navigation -->
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-0">
                        <button onclick="showTab('cart')" class="tab-btn active flex-1 py-4 px-6 text-center font-semibold transition-all bg-green-50 text-green-600 border-b-2 border-green-600" id="cart-tab">
                            🛒 Keranjang Saya
                        </button>
                        <button onclick="showTab('orders')" class="tab-btn flex-1 py-4 px-6 text-center font-semibold transition-all text-gray-500 hover:text-gray-700" id="orders-tab">
                            📦 Riwayat Pesanan
                        </button>
                        <button onclick="showTab('history')" class="tab-btn flex-1 py-4 px-6 text-center font-semibold transition-all text-gray-500 hover:text-gray-700" id="history-tab">
                            📈 Aktivitas Belanja
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Cart Tab -->
                    <div id="cart-content" class="tab-content">
                        <h2 class="text-2xl font-bold mb-6">Item di Keranjang Anda</h2>
                        <div id="cart-items-container">
                            <!-- Cart items will be loaded here -->
                        </div>
                        <div id="cart-empty" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">🛒</div>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">Keranjang Masih Kosong</h3>
                            <p class="text-gray-500 mb-6">Mulai belanja untuk melihat item di sini</p>
                            <a href="store.html" class="inline-block bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition-all">
                                Mulai Belanja
                            </a>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div id="orders-content" class="tab-content hidden">
                        <h2 class="text-2xl font-bold mb-6">Riwayat Pesanan</h2>
                        <div id="orders-container">
                            <!-- Orders will be loaded here -->
                        </div>
                        <div id="orders-empty" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">📦</div>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">Belum Ada Pesanan</h3>
                            <p class="text-gray-500 mb-6">Riwayat pesanan Anda akan muncul di sini</p>
                            <a href="store.html" class="inline-block bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition-all">
                                Belanja Sekarang
                            </a>
                        </div>
                    </div>

                    <!-- History Tab -->
                    <div id="history-content" class="tab-content hidden">
                        <h2 class="text-2xl font-bold mb-6">Aktivitas Belanja</h2>
                        <div id="history-container">
                            <!-- History will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" data-aos="fade-up" data-aos-delay="400">
                <a href="store.html" class="glass-container rounded-xl p-6 text-center hover:shadow-lg transition-all">
                    <div class="text-3xl mb-2">🛍️</div>
                    <div class="font-semibold text-gray-700">Belanja Lagi</div>
                </a>
                <a href="cart.html" class="glass-container rounded-xl p-6 text-center hover:shadow-lg transition-all">
                    <div class="text-3xl mb-2">🛒</div>
                    <div class="font-semibold text-gray-700">Lihat Keranjang</div>
                </a>
                <button onclick="clearCart()" class="glass-container rounded-xl p-6 text-center hover:shadow-lg transition-all">
                    <div class="text-3xl mb-2">🗑️</div>
                    <div class="font-semibold text-gray-700">Kosongkan Keranjang</div>
                </button>
                <a href="https://wa.me/628112638318" target="_blank" class="glass-container rounded-xl p-6 text-center hover:shadow-lg transition-all">
                    <div class="text-3xl mb-2">📞</div>
                    <div class="font-semibold text-gray-700">Bantuan</div>
                </a>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-all duration-300 z-50">
        <span id="toast-message"></span>
    </div>

    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });

        // Global variables
        let currentUser = null;
        let userUID = null;

        // Initialize when page loads
        window.addEventListener('load', async () => {
            try {
                userUID = localStorage.getItem('userUID') || 'guest';
                await loadUserProfile();
                await loadUserStats();
                await loadCartItems();
                
                // Set up auth state listener for Firebase users
                if (window.firebaseAuth) {
                    onAuthStateChanged(firebaseAuth, (user) => {
                        if (user) {
                            currentUser = user;
                            userUID = user.uid;
                        }
                    });
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Gagal memuat profil', 'error');
            }
        });

        // Load user profile
        async function loadUserProfile() {
            try {
                const userName = localStorage.getItem('userName') || 'User';
                const userEmail = localStorage.getItem('userEmail') || '';
                const userPhoto = localStorage.getItem('userPhoto') || 'https://raw.githubusercontent.com/ItzGirin24/TelugeAgro/refs/heads/main/logo%20Teluge.jpg';
                const isAdmin = localStorage.getItem('adminLoggedIn') === 'true';

                // Update profile info
                document.getElementById('userName').textContent = userName;
                document.getElementById('userEmail').textContent = userEmail;
                document.getElementById('userAvatar').src = userPhoto;
                document.getElementById('userRole').textContent = isAdmin ? '👑 Admin' : '🛍️ Customer';

                // Set member since date
                const memberSince = localStorage.getItem('memberSince') || new Date().toLocaleDateString('id-ID');
                document.getElementById('memberSince').textContent = `📅 Member sejak ${memberSince}`;

                // Try to load from Firebase if available
                if (currentUser && window.firebaseDb) {
                    const userRef = doc(firebaseDb, 'users', currentUser.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        if (userData.createdAt) {
                            const createdDate = userData.createdAt.toDate().toLocaleDateString('id-ID');
                            document.getElementById('memberSince').textContent = `📅 Member sejak ${createdDate}`;
                        }
                    }
                }

            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        // Load user statistics
        async function loadUserStats() {
            try {
                // Load cart count
                const cart = JSON.parse(localStorage.getItem(`cart_${userUID}`)) || {};
                const cartItems = Object.values(cart);
                const cartCount = cartItems.reduce((sum, item) => sum + (item.quantity || 0), 0);
                document.getElementById('cartItemsCount').textContent = cartCount;

                // Load order statistics from Firebase
                if (window.firebaseDb) {
                    const ordersQuery = query(
                        collection(firebaseDb, 'orders'),
                        where('customerUID', '==', userUID),
                        orderBy('timestamp', 'desc')
                    );

                    const ordersSnapshot = await getDocs(ordersQuery);
                    const orders = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                    document.getElementById('totalOrders').textContent = orders.length;

                    // Calculate total spent
                    const totalSpent = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                    document.getElementById('totalSpent').textContent = `Rp ${formatPrice(totalSpent)}`;

                    // Calculate loyalty points (10% of total spent)
                    const loyaltyPoints = Math.floor(totalSpent / 1000);
                    document.getElementById('loyaltyPoints').textContent = loyaltyPoints;
                }

            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        // Load cart items
        async function loadCartItems() {
            try {
                const cartContainer = document.getElementById('cart-items-container');
                const cartEmpty = document.getElementById('cart-empty');
                
                const cart = JSON.parse(localStorage.getItem(`cart_${userUID}`)) || {};
                const cartItems = Object.values(cart);

                if (cartItems.length === 0) {
                    cartContainer.innerHTML = '';
                    cartEmpty.classList.remove('hidden');
                    return;
                }

                cartEmpty.classList.add('hidden');
                
                cartContainer.innerHTML = cartItems.map(item => `
                    <div class="cart-item rounded-xl p-4 mb-4 flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <img src="https://via.placeholder.com/60x60?text=🍌" alt="${item.product}" class="w-15 h-15 rounded-lg object-cover">
                            <div>
                                <h3 class="font-semibold text-gray-800">${item.product}</h3>
                                <p class="text-sm text-gray-600">Rp ${formatPrice(item.price)}/kg</p>
                                <p class="text-sm font-medium text-green-600">${item.quantity} kg</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-bold text-gray-800">Rp ${formatPrice(item.price * item.quantity)}</p>
                            <button onclick="removeFromCart('${item.product}')" class="text-sm text-red-500 hover:text-red-700 transition-colors">
                                Hapus
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading cart items:', error);
            }
        }

        // Load order history
        async function loadOrderHistory() {
            try {
                const ordersContainer = document.getElementById('orders-container');
                const ordersEmpty = document.getElementById('orders-empty');

                if (!window.firebaseDb) {
                    ordersContainer.innerHTML = '<p class="text-gray-500 text-center">Riwayat pesanan tidak tersedia</p>';
                    return;
                }

                const ordersQuery = query(
                    collection(firebaseDb, 'orders'),
                    where('customerUID', '==', userUID),
                    orderBy('timestamp', 'desc')
                );

                const ordersSnapshot = await getDocs(ordersQuery);
                const orders = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                if (orders.length === 0) {
                    ordersContainer.innerHTML = '';
                    ordersEmpty.classList.remove('hidden');
                    return;
                }

                ordersEmpty.classList.add('hidden');

                ordersContainer.innerHTML = orders.map(order => `
                    <div class="order-item bg-white rounded-xl p-6 mb-4 border border-gray-200">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg text-gray-800">Order #${order.id.slice(-8)}</h3>
                                <p class="text-sm text-gray-600">${order.timestamp.toDate().toLocaleDateString('id-ID', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                })}</p>
                            </div>
                            <span class="status-badge ${getStatusClass(order.status)}">${getStatusText(order.status)}</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-2">Produk:</p>
                                ${order.items.map(item => `
                                    <p class="text-sm text-gray-600">• ${item.product} (${item.quantity}kg)</p>
                                `).join('')}
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-green-600">Rp ${formatPrice(order.total)}</p>
                                <button onclick="viewOrderDetails('${order.id}')" class="mt-2 text-sm bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                    Lihat Detail
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading order history:', error);
                document.getElementById('orders-container').innerHTML = '<p class="text-red-500 text-center">Gagal memuat riwayat pesanan</p>';
            }
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-green-50', 'text-green-600', 'border-b-2', 'border-green-600');
                btn.classList.add('text-gray-500', 'hover:text-gray-700');
            });

            // Show selected tab
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            
            // Add active class to selected tab button
            const activeBtn = document.getElementById(`${tabName}-tab`);
            activeBtn.classList.remove('text-gray-500', 'hover:text-gray-700');
            activeBtn.classList.add('active', 'bg-green-50', 'text-green-600', 'border-b-2', 'border-green-600');

            // Load content based on tab
            if (tabName === 'orders') {
                loadOrderHistory();
            } else if (tabName === 'history') {
                loadShoppingHistory();
            }
        }

        // Load shopping history
        function loadShoppingHistory() {
            const historyContainer = document.getElementById('history-container');
            
            const cartHistory = JSON.parse(localStorage.getItem(`cartHistory_${userUID}`)) || [];
            
            if (cartHistory.length === 0) {
                historyContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📈</div>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">Belum Ada Aktivitas</h3>
                        <p class="text-gray-500">Riwayat aktivitas belanja Anda akan muncul di sini</p>
                    </div>
                `;
                return;
            }

            historyContainer.innerHTML = cartHistory.map(activity => `
                <div class="bg-white rounded-xl p-4 mb-3 border border-gray-200 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">${activity.action === 'add' ? '➕' : activity.action === 'remove' ? '➖' : '🛒'}</div>
                        <div>
                            <p class="font-semibold text-gray-800">${activity.productName}</p>
                            <p class="text-sm text-gray-600">${activity.action === 'add' ? 'Ditambahkan ke keranjang' : 'Dihapus dari keranjang'}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">${new Date(activity.timestamp).toLocaleDateString('id-ID')}</p>
                        <p class="text-sm font-medium text-green-600">${activity.quantity} kg</p>
                    </div>
                </div>
            `).join('');
        }

        // Utility functions
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID').format(Math.round(price));
        }

        function getStatusClass(status) {
            const classes = {
                'pending': 'status-pending',
                'paid': 'status-paid',
                'processing': 'status-processing',
                'completed': 'status-completed'
            };
            return classes[status] || 'status-pending';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'Menunggu Bayar',
                'paid': 'Dibayar',
                'processing': 'Diproses',
                'completed': 'Selesai'
            };
            return texts[status] || 'Unknown';
        }

        // Cart management
        function removeFromCart(productName) {
            if (confirm(`Hapus ${productName} dari keranjang?`)) {
                const cart = JSON.parse(localStorage.getItem(`cart_${userUID}`)) || {};
                delete cart[productName];
                localStorage.setItem(`cart_${userUID}`, JSON.stringify(cart));
                
                // Add to history
                addToCartHistory('remove', productName);
                
                loadCartItems();
                loadUserStats();
                showToast(`${productName} dihapus dari keranjang`);
            }
        }

        function clearCart() {
            if (confirm('Kosongkan semua item di keranjang?')) {
                localStorage.setItem(`cart_${userUID}`, JSON.stringify({}));
                loadCartItems();
                loadUserStats();
                showToast('Keranjang berhasil dikosongkan');
            }
        }

        // Add activity to cart history
        function addToCartHistory(action, productName, quantity = 1) {
            const cartHistory = JSON.parse(localStorage.getItem(`cartHistory_${userUID}`)) || [];
            cartHistory.unshift({
                action,
                productName,
                quantity,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 50 activities
            if (cartHistory.length > 50) {
                cartHistory.splice(50);
            }
            
            localStorage.setItem(`cartHistory_${userUID}`, JSON.stringify(cartHistory));
        }

        // Navigation functions
        function viewOrderDetails(orderId) {
            // Redirect to order details page or show modal
            showToast('Fitur detail pesanan akan segera hadir');
        }

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                localStorage.clear();
                window.location.href = 'login.html';
            }
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = `fixed top-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 z-50 ${type === 'error' ? 'bg-red-600' : 'bg-green-600'}`;
            toastMessage.textContent = message;
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }
    </script>
</body>
</html>